# ═══════════════════════════════════════════════════════════════════════════════
# ENTREPRENEURSHIP BOOSTER PLATFORM - MASTER ENVIRONMENT CONFIGURATION
# ═══════════════════════════════════════════════════════════════════════════════
# Version: 3.1.0 - Fixed Port Conflicts
# Author: Douglas Kings Kato
# Last Updated: 2025-11-21
# Purpose: Centralized configuration for all microservices
#
# INSTRUCTIONS:
# 1. This is the MASTER .env file - all services read from here
# 2. Never commit this file to Git (it's in .gitignore)
# 3. Copy to production and update all <CHANGE_ME> values
# 4. Each microservice can override these with their own .env
# ═══════════════════════════════════════════════════════════════════════════════

# ═══════════════════════════════════════════════════════════════════════════════
# SECTION 1: GLOBAL APPLICATION SETTINGS
# ═══════════════════════════════════════════════════════════════════════════════

# Environment Type (controls logging, security, etc.)
# Options: development | staging | production
ENVIRONMENT=development
SPRING_PROFILES_ACTIVE=dev
APP_ENV=development

# Application Identity
APP_NAME=Entrepreneurship Booster Platform
APP_VERSION=3.1.0
COMPOSE_PROJECT_NAME=ebp-platform

# Timezone Configuration
TZ=Africa/Kampala
APP_TIMEZONE=Africa/Kampala

# Localization
APP_DEFAULT_LANGUAGE=en
APP_SUPPORTED_LANGUAGES=en,lg,lur,lgb

# Base URLs - Development Environment
FRONTEND_URL=http://localhost:3000
BACKEND_URL=http://localhost:8080
API_GATEWAY_URL=http://localhost:8080

# ═══════════════════════════════════════════════════════════════════════════════
# SECTION 2: MICROSERVICE PORT ALLOCATION
# ═══════════════════════════════════════════════════════════════════════════════
# CRITICAL: Each service MUST have a unique port to avoid conflicts
# Port Range Strategy:
# - 8000-8099: Business logic services
# - 8760-8769: Infrastructure services
# - 9000-9099: Monitoring/Admin services
# ═══════════════════════════════════════════════════════════════════════════════

# Infrastructure Services (8760-8769)
SERVICE_REGISTRY_PORT=8761          # Eureka Service Discovery
API_GATEWAY_PORT=8080               # Spring Cloud Gateway (standard port)

# Core Business Services (8081-8092) - FIXED ALLOCATION
USER_SERVICE_PORT=8181              # User Management (Profile, Registration)
AUTH_SERVICE_PORT=8082              # Authentication & Authorization
OPPORTUNITY_SERVICE_PORT=8083       # Business Opportunities
CONTENT_SERVICE_PORT=8084           # Content Management (Articles, Resources)
JOB_SERVICE_PORT=8085               # Job Listings & Applications
NOTIFICATION_SERVICE_PORT=8086      # Multi-channel Notifications
MENTOR_SERVICE_PORT=8087            # Mentorship Matching
FILE_SERVICE_PORT=8088              # File Upload/Download Management
AI_SERVICE_PORT=8089                # AI Recommendations & ML
ANALYTICS_SERVICE_PORT=8090         # Business Analytics & Reporting
EDGE_FUNCTIONS_PORT=8091            # Serverless Edge Functions
USSD_SERVICE_PORT=8092              # USSD Gateway Integration

# Legacy/Alternative Ports (for backward compatibility)
FILE_MANAGEMENT_SERVICE_PORT=8088   # Alias for FILE_SERVICE_PORT

# Monitoring & Admin Services (9000-9099)
PROMETHEUS_PORT=9090                # Metrics Collection
GRAFANA_PORT=3000                   # Monitoring Dashboards

# ═══════════════════════════════════════════════════════════════════════════════
# SECTION 3: POSTGRESQL DATABASE CONFIGURATION
# ═══════════════════════════════════════════════════════════════════════════════

# PostgreSQL Server Connection
POSTGRES_HOST=localhost
POSTGRES_PORT=5432
POSTGRES_IMAGE=postgres:15-alpine

# Master Admin Credentials (for database creation/management)
# SECURITY: These are your actual credentials - keep them secure!
POSTGRES_USER=postgres
POSTGRES_PASSWORD=Kato20!
DB_ADMIN_USER=postgres
DB_ADMIN_PASSWORD=Kato20!

# Application Database User (restricted permissions for security)
# This user is created by init-databases.sql and has limited privileges
DB_USER=youthconnect_user
DB_APP_USER=youthconnect_user
DB_PASSWORD=YouthConnect2024!
DB_APP_PASSWORD=YouthConnect2024!

# Dedicated Database per Microservice (Best Practice for Microservices)
# Each service gets its own isolated database to prevent coupling
POSTGRES_DB_AUTH=youthconnect_auth              # Authentication data
POSTGRES_DB_USER=youthconnect_user              # User profiles & settings
POSTGRES_DB_JOB=youthconnect_job                # Job listings
POSTGRES_DB_OPPORTUNITY=youthconnect_opportunity # Business opportunities
POSTGRES_DB_MENTOR=youthconnect_mentor          # Mentorship data
POSTGRES_DB_CONTENT=youthconnect_content        # CMS content
POSTGRES_DB_NOTIFICATION=youthconnect_notification # Notification queue
POSTGRES_DB_FILE=youthconnect_file              # File metadata
POSTGRES_DB_AI=youthconnect_ai                  # ML models & training data
POSTGRES_DB_ANALYTICS=youthconnect_analytics    # Analytics aggregations
POSTGRES_DB_USSD=youthconnect_ussd              # USSD session data

# Legacy Database Name Aliases (for backward compatibility)
DB_AUTH=youthconnect_auth
DB_USER_DB=youthconnect_user
DB_NAME=youthconnect_user                       # Default for user-service
DB_JOB=youthconnect_job
DB_OPPORTUNITY=youthconnect_opportunity
DB_MENTOR=youthconnect_mentor
DB_CONTENT=youthconnect_content
DB_NOTIFICATION=youthconnect_notification
DB_FILE=youthconnect_file
DB_AI=youthconnect_ai
DB_ANALYTICS=youthconnect_analytics
DB_USSD=youthconnect_ussd

# Connection Pool Configuration (HikariCP)
DB_MAX_POOL_SIZE=20                 # Maximum connections per service
DB_MIN_IDLE=5                       # Minimum idle connections
DB_CONNECTION_TIMEOUT=120000        # 2 minutes - wait time for connection

# JPA/Hibernate Settings
# IMPORTANT: Use 'validate' in production to prevent accidental schema changes
SPRING_JPA_HIBERNATE_DDL_AUTO=update    # Development: auto-update schema
SPRING_JPA_SHOW_SQL=false               # Set to 'true' for SQL debugging

# ═══════════════════════════════════════════════════════════════════════════════
# SECTION 4: REDIS CACHE & SESSION MANAGEMENT
# ═══════════════════════════════════════════════════════════════════════════════

# Redis Server Configuration
REDIS_HOST=localhost
REDIS_PORT=6379
REDIS_PASSWORD=                     # Empty for development (no auth)
REDIS_DATABASE=0                    # Default database index

# Redis Connection Pool
REDIS_MAX_ACTIVE=20                 # Maximum active connections
REDIS_MAX_IDLE=10                   # Maximum idle connections
REDIS_MIN_IDLE=5                    # Minimum idle connections

# ═══════════════════════════════════════════════════════════════════════════════
# SECTION 5: JWT SECURITY CONFIGURATION
# ═══════════════════════════════════════════════════════════════════════════════
# CRITICAL: JWT_SECRET must be identical across ALL services
# Generate a new secret with: openssl rand -base64 64
# ═══════════════════════════════════════════════════════════════════════════════

# JWT Secret Key (256-bit minimum)
# CHANGE THIS IN PRODUCTION! Use a cryptographically secure random value
JWT_SECRET=aVeryLongAndSecureSecretKeyForYouthConnectUgandaHackathonProjectWith256BitsMinimum

# JWT Token Settings
JWT_ISSUER=youth-connect-auth-service       # Who issued the token
JWT_AUDIENCE=youth-connect-platform         # Who can use the token
JWT_ACCESS_TOKEN_EXPIRY=900                 # 15 minutes (in seconds)
JWT_REFRESH_TOKEN_EXPIRY=604800             # 7 days (in seconds)

# ═══════════════════════════════════════════════════════════════════════════════
# SECTION 6: INTERNAL SERVICE SECURITY
# ═══════════════════════════════════════════════════════════════════════════════
# Used for service-to-service authentication (e.g., Job Service → User Service)
# All internal API endpoints require this key in the X-Internal-API-Key header
#
# SECURITY BEST PRACTICES:
# - Generate with: openssl rand -base64 32
# - Use different keys for dev/staging/prod
# - Rotate every 90 days in production
# - Never log or expose this key
# ═══════════════════════════════════════════════════════════════════════════════

INTERNAL_API_KEY=dev-internal-api-key-youthconnect-2024-change-in-production

# ═══════════════════════════════════════════════════════════════════════════════
# SECTION 7: EUREKA SERVICE DISCOVERY
# ═══════════════════════════════════════════════════════════════════════════════

# Eureka Server Configuration
EUREKA_ENABLED=true
EUREKA_HOST=localhost
EUREKA_PORT=8761
EUREKA_URL=http://localhost:8761/eureka/

# Eureka Authentication (Basic Auth)
# CHANGE IN PRODUCTION!
EUREKA_USERNAME=admin
EUREKA_PASSWORD=changeme

# ═══════════════════════════════════════════════════════════════════════════════
# SECTION 8: CORS CONFIGURATION
# ═══════════════════════════════════════════════════════════════════════════════
# Cross-Origin Resource Sharing - allows web apps to call your APIs
# ═══════════════════════════════════════════════════════════════════════════════

# Allowed Origins (comma-separated list)
# Development: Include all local dev servers
# Production: Only your production frontend domains
CORS_ALLOWED_ORIGINS=http://localhost:3000,http://localhost:3001,http://localhost:19006

# Allowed HTTP Methods
CORS_ALLOWED_METHODS=GET,POST,PUT,DELETE,PATCH,OPTIONS

# Allowed Headers (* allows all headers)
CORS_ALLOWED_HEADERS=*

# Allow Credentials (cookies, auth headers)
CORS_ALLOW_CREDENTIALS=true

# Preflight Cache Duration (in seconds)
CORS_MAX_AGE=3600

# ═══════════════════════════════════════════════════════════════════════════════
# SECTION 9: FILE STORAGE CONFIGURATION
# ═══════════════════════════════════════════════════════════════════════════════

# Storage Backend Type
# Options: LOCAL | S3 | AZURE | MINIO
STORAGE_TYPE=LOCAL

# Local Storage Path (for development)
STORAGE_PATH=uploads/
APP_UPLOAD_DIR=./uploads

# File Size Limits (in bytes)
FILE_MAX_SIZE=52428800              # 50 MB max file size
MAX_FILE_SIZE=10485760              # 10 MB (legacy)
MAX_REQUEST_SIZE=15728640           # 15 MB total request size

# File Service Base URL
BASE_URL=http://localhost:8088

# ═══════════════════════════════════════════════════════════════════════════════
# SECTION 10: LOGGING CONFIGURATION
# ═══════════════════════════════════════════════════════════════════════════════

# Log Levels
# Options: TRACE | DEBUG | INFO | WARN | ERROR | FATAL
LOG_LEVEL_ROOT=INFO                 # Root logger level
LOG_LEVEL_APP=DEBUG                 # Application logger level

# Log File Configuration
LOG_PATH=./logs                     # Log directory path

# ═══════════════════════════════════════════════════════════════════════════════
# SECTION 11: RATE LIMITING (OPTIONAL)
# ═══════════════════════════════════════════════════════════════════════════════

# Global Rate Limiting
RATE_LIMIT_ENABLED=false            # Enable/disable rate limiting
RATE_LIMIT_REQUESTS_PER_MINUTE=100  # Max requests per minute per IP

# ═══════════════════════════════════════════════════════════════════════════════
# SECTION 12: EXTERNAL INTEGRATIONS (PLACEHOLDERS)
# ═══════════════════════════════════════════════════════════════════════════════

# Africa's Talking (SMS & USSD)
AFRICASTALKING_USERNAME=sandbox
AFRICASTALKING_API_KEY=<CHANGE_ME>
USSD_SERVICE_CODE=*256#

# SMTP Email Configuration
SMTP_HOST=smtp.gmail.com
SMTP_PORT=587
SMTP_USERNAME=<CHANGE_ME>
SMTP_PASSWORD=<CHANGE_ME>
SMTP_FROM=noreply@entrepreneurshipbooster.ug

# AWS S3 (if STORAGE_TYPE=S3)
AWS_ACCESS_KEY_ID=<CHANGE_ME>
AWS_SECRET_ACCESS_KEY=<CHANGE_ME>
AWS_REGION=eu-west-1
AWS_S3_BUCKET=ebp-uploads

# ═══════════════════════════════════════════════════════════════════════════════
# SECTION 13: FEATURE FLAGS
# ═══════════════════════════════════════════════════════════════════════════════

# Notification Channels
NOTIFICATION_EMAIL_ENABLED=true
NOTIFICATION_SMS_ENABLED=true
NOTIFICATION_PUSH_ENABLED=false

# Core Features
FEATURE_AI_RECOMMENDATIONS=true
FEATURE_ANALYTICS=true
FEATURE_USSD_ACCESS=true

# ═══════════════════════════════════════════════════════════════════════════════
# SECTION 14: DOCKER CONFIGURATION
# ═══════════════════════════════════════════════════════════════════════════════

COMPOSE_PROJECT_NAME=ebp-platform
DOCKER_NETWORK=ebp-network

# ═══════════════════════════════════════════════════════════════════════════════
# DEPLOYMENT CHECKLIST (Before Production)
# ═══════════════════════════════════════════════════════════════════════════════
#
# ☐ Change all passwords marked with <CHANGE_ME>
# ☐ Generate new JWT_SECRET: openssl rand -base64 64
# ☐ Generate new INTERNAL_API_KEY: openssl rand -base64 32
# ☐ Update CORS_ALLOWED_ORIGINS to production domain only
# ☐ Set SPRING_JPA_HIBERNATE_DDL_AUTO=validate
# ☐ Set LOG_LEVEL_ROOT=WARN
# ☐ Enable SSL/TLS certificates
# ☐ Configure real SMTP/SMS credentials
# ☐ Set up AWS S3 for file storage
# ☐ Enable rate limiting
# ☐ Set file permissions: chmod 600 .env
#
# ═══════════════════════════════════════════════════════════════════════════════