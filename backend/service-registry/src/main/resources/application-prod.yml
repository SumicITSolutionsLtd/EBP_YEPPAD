# ================================================================================
# Service Registry (Eureka Server) - PRODUCTION Configuration
# ================================================================================

spring:
  application:
    name: service-registry

server:
  port: 8761
  compression:
    enabled: true
  tomcat:
    threads:
      max: 400
      min-spare: 20
    max-connections: 8192
    accept-count: 100

# ================================================================================
# Eureka Server Configuration - PRODUCTION
# ================================================================================
eureka:
  instance:
    hostname: ${EUREKA_HOSTNAME:service-registry}
    prefer-ip-address: true
    lease-renewal-interval-in-seconds: 30
    lease-expiration-duration-in-seconds: 90

  client:
    register-with-eureka: false
    fetch-registry: false
    service-url:
      defaultZone: ${EUREKA_SERVER_URL:http://localhost:8761/eureka/}

  server:
    # PRODUCTION: Enable self-preservation
    enable-self-preservation: true
    eviction-interval-timer-in-ms: 15000

    # Response cache (balance performance vs freshness)
    response-cache-auto-expiration-in-seconds: 180
    response-cache-update-interval-ms: 30000

    # Rate limiting (stricter in production)
    rate-limiter-enabled: true
    rate-limiter-burst-size: 50
    rate-limiter-registry-fetch-average-rate: 500
    rate-limiter-full-fetch-average-rate: 100

# ================================================================================
# Security - PRODUCTION
# ================================================================================
eureka:
  security:
    username: ${EUREKA_USERNAME:admin}
    password: ${EUREKA_PASSWORD:changeme_in_production}

# ================================================================================
# Management - PRODUCTION
# ================================================================================
management:
  endpoints:
    web:
      exposure:
        include: health,info,metrics,prometheus
  endpoint:
    health:
      show-details: when-authorized
  metrics:
    export:
      prometheus:
        enabled: true

# ================================================================================
# Logging - PRODUCTION
# ================================================================================
logging:
  level:
    root: WARN
    com.netflix.eureka: INFO
    com.netflix.discovery: INFO
    com.youthconnect.service_registry: INFO
  file:
    name: /var/log/youth-connect/service-registry.log
    max-size: 100MB
    max-history: 60
    total-size-cap: 5GB