# ============================================================================
# Entrepreneurship Booster Platform - User Service Docker Compose
# ============================================================================
# Services:
# - user-service: Main application
# - postgres-db: PostgreSQL database with initialization scripts
# - mysql-db: MySQL database for legacy/job service
# - redis-cache: Optional caching layer
#
# Usage:
#   Development: docker-compose up -d
#   Production: Use docker-compose.prod.yml
#   Stop: docker-compose down
#   Logs: docker-compose logs -f user-service
# ============================================================================

version: '3.8'

services:
  # PostgreSQL Database for User Service
  postgres-user-db:
    image: postgres:16-alpine
    container_name: youthconnect-user-postgres
    environment:
      POSTGRES_USER: youthconnect_user
      POSTGRES_PASSWORD: YouthConnect2024!
      POSTGRES_DB: youthconnect_user
      PGDATA: /var/lib/postgresql/data/pgdata
    ports:
      - "5432:5432"
    volumes:
      - postgres-user-data:/var/lib/postgresql/data
      - ./src/main/resources/db/migration:/docker-entrypoint-initdb.d:ro
    networks:
      - youthconnect-network
    healthcheck:
      test: ["CMD-SHELL", "pg_isready -U youthconnect_user -d youthconnect_user"]
      interval: 10s
      timeout: 5s
      retries: 5

  # User Service
  user-service:
    build:
      context: .
      dockerfile: Dockerfile
    container_name: youthconnect-user-service
    environment:
      SPRING_PROFILES_ACTIVE: docker
      DB_HOST: postgres-user-db
      DB_PORT: 5432
      DB_NAME: youthconnect_user
      DB_USER: youthconnect_user
      DB_PASSWORD: YouthConnect2024!
      EUREKA_URL: http://service-registry:8761/eureka/
    ports:
      - "8081:8081"
    depends_on:
      postgres-user-db:
        condition: service_healthy
    networks:
      - youthconnect-network

volumes:
  postgres-user-data:
    name: youthconnect-user-postgres-data

networks:
  youthconnect-network:
    name: youthconnect-network
    driver: bridge